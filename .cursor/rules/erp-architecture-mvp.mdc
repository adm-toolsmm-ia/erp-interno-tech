---
alwaysApply: true
description: "Arquitetura MVP do ERP Interno Tech com foco em multi-tenancy e IA"
---

# ğŸ—ï¸ ERP Architecture MVP â€” ERPInternoTech

## Contexto do Projeto
- **ERP interno** da empresa Tech em fase **MVP**
- **Back-end**: Supabase (Postgres + Storage + Edge Functions)
- **Front-end**: Next.js 15 (App Router) + Tailwind + Shadcn/UI + Prisma ORM
- **Deploy**: Vercel (Prod, Preview/HomologaÃ§Ã£o, Dev)
- **AutenticaÃ§Ã£o**: NÃ£o implementada no MVP (Fase 2)

## Regras de Arquitetura ObrigatÃ³rias

### Multi-Tenancy Rigorosa
- **TODAS** as operaÃ§Ãµes devem filtrar por `empresaId`
- **TODAS** as queries Prisma devem incluir `where: { empresaId }`
- **TODAS** as APIs devem retornar `tenantId` no meta
- **NUNCA** expor dados de outras empresas

### Soft Delete Universal
- **TODOS** os modelos devem ter `deletedAt: DateTime?`
- **TODAS** as queries devem filtrar `deletedAt: null`
- **TODAS** as exclusÃµes devem ser soft delete
- **NUNCA** deletar dados permanentemente

### Seeds Versionados
- Seeds em `prisma/seed.ts` com versionamento
- DocumentaÃ§Ã£o de classificaÃ§Ã£o para IA
- CSV + Markdown explicativo
- Versionamento semÃ¢ntico dos seeds

### Testes ObrigatÃ³rios
- **SEMPRE** gerar testes unitÃ¡rios bÃ¡sicos (CRUD)
- **SEMPRE** testar multi-tenancy
- **SEMPRE** testar soft delete
- **SEMPRE** testar validaÃ§Ãµes

### Observabilidade MÃ­nima
- Endpoint `/api/health` obrigatÃ³rio
- Logs de erro em console estruturados
- MÃ©tricas bÃ¡sicas de performance
- Rastreamento de operaÃ§Ãµes crÃ­ticas

## Estrutura de Pastas ObrigatÃ³ria
```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ health/
â”‚   â”‚   â”œâ”€â”€ empresas/
â”‚   â”‚   â”œâ”€â”€ clientes/
â”‚   â”‚   â”œâ”€â”€ projetos/
â”‚   â”‚   â”œâ”€â”€ documentos/
â”‚   â”‚   â””â”€â”€ orcamentos/
â”‚   â””â”€â”€ (dashboard)/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/           # Shadcn/UI components
â”‚   â”œâ”€â”€ forms/        # FormulÃ¡rios especÃ­ficos
â”‚   â”œâ”€â”€ tables/       # Tabelas e listas
â”‚   â”œâ”€â”€ modals/       # Modais de criaÃ§Ã£o
â”‚   â”œâ”€â”€ drawers/      # Drawers de ediÃ§Ã£o
â”‚   â””â”€â”€ dashboards/   # VisÃµes 360Âº
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ prisma.ts
â”‚   â”œâ”€â”€ supabase.ts
â”‚   â”œâ”€â”€ auth.ts       # PreparaÃ§Ã£o para Fase 2
â”‚   â””â”€â”€ utils.ts
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ use-tenant.ts
â”‚   â”œâ”€â”€ use-crud.ts
â”‚   â””â”€â”€ use-export.ts
â””â”€â”€ types/
    â”œâ”€â”€ api.ts
    â”œâ”€â”€ database.ts
    â””â”€â”€ ui.ts
```

## PadrÃµes de API ObrigatÃ³rios

### Estrutura de Resposta
```typescript
interface ApiResponse<T> {
  data: T;
  meta: {
    tenantId: string;
    requestId: string;
    timestamp: string;
    version: string;
  };
}
```

### Endpoints PadrÃ£o
```typescript
// GET /api/[resource]
async function GET(request: Request, { params }: { params: { resource: string } }) {
  // Sempre filtrar por empresaId
  // Sempre incluir meta
  // Sempre paginar
}

// POST /api/[resource]
async function POST(request: Request) {
  // Sempre validar empresaId
  // Sempre aplicar soft delete
  // Sempre retornar meta
}

// PUT /api/[resource]/[id]
async function PUT(request: Request, { params }: { params: { id: string } }) {
  // Sempre validar tenant
  // Sempre aplicar soft delete
  // Sempre auditar mudanÃ§as
}

// DELETE /api/[resource]/[id]
async function DELETE(request: Request, { params }: { params: { id: string } }) {
  // Sempre soft delete
  // Sempre auditar
  // Sempre validar tenant
}
```

## ReferÃªncias de DocumentaÃ§Ã£o
- [UX/UI Guidelines](mdc:docs/06-ux-ui.md)
- [UX Flows](mdc:docs/07-ux-flows.md)
- [UI Components](mdc:docs/08-ux-components.md)
- [Commit Standards](mdc:docs/09-git-commit-guide.md)